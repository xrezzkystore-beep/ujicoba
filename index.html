<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xrezzky Store - Marketplace</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
        }

        /* ========== LOGIN PAGE ========== */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-box {
            background: white;
            padding: 50px 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 400px;
        }

        .login-box h1 {
            text-align: center;
            font-size: 28px;
            margin-bottom: 10px;
            color: #333;
        }

        .login-box h2 {
            text-align: center;
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 40px;
            color: #000;
        }

        .login-box input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #333;
            border-radius: 10px;
            font-size: 16px;
            font-style: italic;
        }

        .login-box input::placeholder {
            color: #999;
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: #00bcd4;
            color: black;
            border: none;
            border-radius: 10px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .login-btn:hover {
            background: #00acc1;
        }

        .login-links {
            text-align: center;
            margin-top: 20px;
            font-style: italic;
        }

        .login-links a {
            color: #667eea;
            text-decoration: none;
            margin: 0 15px;
            cursor: pointer;
        }

        .login-links a:hover {
            text-decoration: underline;
        }

        /* ========== REGISTER PAGE ========== */
        .register-container {
            display: none;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .register-box {
            background: white;
            padding: 50px 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 400px;
        }

        .register-box h1 {
            text-align: center;
            font-size: 28px;
            margin-bottom: 30px;
            color: #333;
        }

        /* ========== MARKETPLACE PAGE ========== */
        .marketplace-container {
            display: none;
        }

        .marketplace-header {
            background: white;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .search-bar {
            flex: 1;
            margin: 0 20px;
            display: flex;
            gap: 10px;
        }

        .search-bar input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .search-bar button {
            padding: 10px 20px;
            background: #00bcd4;
            color: black;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 10px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        .nav-tab.active {
            background: #00bcd4;
            color: black;
        }

        .nav-tab:hover {
            background: #00acc1;
        }

        .marketplace-content {
            display: flex;
            gap: 20px;
            padding: 20px;
        }

        .sidebar {
            width: 250px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        .sidebar h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .sidebar-item {
            padding: 10px;
            background: #f9f9f9;
            margin-bottom: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s;
        }

        .sidebar-item:hover {
            background: #00bcd4;
            color: white;
        }

        .main-content {
            flex: 1;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .product-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: 0.3s;
            cursor: pointer;
        }

        .product-card:hover {
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            transform: translateY(-5px);
        }

        .product-image {
            width: 100%;
            height: 200px;
            background: #90EE90;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .product-info {
            padding: 15px;
        }

        .product-name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .product-price {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .product-stock {
            font-size: 12px;
            color: #999;
            margin-bottom: 15px;
        }

        .product-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: 0.3s;
        }

        .btn-buy {
            background: #ff4444;
            color: white;
        }

        .btn-buy:hover {
            background: #cc0000;
        }

        .btn-cart {
            background: #ffeb3b;
            color: black;
        }

        .btn-cart:hover {
            background: #fdd835;
        }

        .btn-question {
            background: #999;
            color: white;
        }

        .btn-question:hover {
            background: #666;
        }

        /* ========== MODAL ========== */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            overflow-y: auto;
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #666;
        }

        .close-btn:hover {
            color: #000;
        }

        .product-detail-image {
            width: 100%;
            height: 300px;
            background: #90EE90;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            border-radius: 10px;
        }

        .product-detail-info h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .product-detail-info p {
            margin-bottom: 10px;
            color: #666;
            line-height: 1.6;
        }

        .rating-stars {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .star {
            color: #ffb800;
            font-size: 18px;
        }

        .testimonials {
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }

        .testimonial-item {
            background: #f9f9f9;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            font-size: 14px;
        }

        .testimonial-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .testimonial-date {
            font-size: 12px;
            color: #999;
            margin-bottom: 5px;
        }

        .testimonial-text {
            color: #666;
        }

        /* ========== ACCOUNT PAGE ========== */
        .account-container {
            display: none;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .account-card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .account-card h2 {
            margin-bottom: 20px;
            color: #333;
            border-bottom: 2px solid #00bcd4;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn-primary {
            background: #00bcd4;
            color: black;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        .btn-primary:hover {
            background: #00acc1;
        }

        .btn-danger {
            background: #ff4444;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        .btn-danger:hover {
            background: #cc0000;
        }

        .btn-logout {
            background: #999;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
            margin-right: 10px;
        }

        .btn-logout:hover {
            background: #666;
        }

        /* ========== ADMIN PANEL ========== */
        .admin-container {
            display: none;
            padding: 20px;
        }

        .admin-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .admin-nav button {
            padding: 10px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        .admin-nav button.active {
            background: #00bcd4;
            color: black;
        }

        .admin-section {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .admin-section.active {
            display: block;
        }

        .table-responsive {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table th {
            background: #f0f0f0;
            padding: 15px;
            text-align: left;
            border-bottom: 2px solid #ddd;
            font-weight: bold;
        }

        table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        table tr:hover {
            background: #f9f9f9;
        }

        .btn-edit {
            background: #4CAF50;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 5px;
        }

        .btn-delete {
            background: #ff4444;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* ========== BOTTOM NAVIGATION ========== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 2px solid #ddd;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }

        .home-btn {
            background: #90EE90;
            color: black;
            padding: 12px 30px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: 0.3s;
        }

        .home-btn:hover {
            background: #7FD87F;
        }

        .home-text {
            text-align: center;
            margin-top: 8px;
            font-size: 12px;
            color: #666;
        }

        /* ========== ALERT & TOAST ========== */
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            display: none;
        }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 768px) {
            .marketplace-content {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                order: 2;
            }

            .main-content {
                order: 1;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }

            .search-bar {
                flex-direction: column;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .nav-tab {
                width: 100%;
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
            }

            .admin-nav {
                flex-direction: column;
            }

            .admin-nav button {
                width: 100%;
            }
        }
    </style>
</head>
<body>

    <!-- ========== LOGIN PAGE ========== -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <h1>MARKETPLACE</h1>
            <h2>XREZZKY STORE</h2>
            <input type="text" id="loginUsername" placeholder="Username">
            <input type="email" id="loginEmail" placeholder="Gmail">
            <input type="password" id="loginPassword" placeholder="Password">
            <button class="login-btn" onclick="handleLogin()">LOGIN</button>
            <div class="login-links">
                <a onclick="showRegister()">Daftar</a>
                <span>|</span>
                <a onclick="showForgotPassword()">Lupa Password</a>
            </div>
        </div>
    </div>

    <!-- ========== REGISTER PAGE ========== -->
    <div id="registerPage" class="register-container">
        <div class="register-box">
            <h1>Daftar Akun Baru</h1>
            <div class="alert" id="registerAlert"></div>
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="regUsername" placeholder="Masukkan username">
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="regEmail" placeholder="Masukkan email">
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="regPassword" placeholder="Masukkan password">
            </div>
            <div class="form-group">
                <label>Konfirmasi Password</label>
                <input type="password" id="regConfirmPassword" placeholder="Konfirmasi password">
            </div>
            <button class="btn-primary" onclick="handleRegister()">Daftar</button>
            <div class="login-links" style="margin-top: 20px;">
                <a onclick="showLogin()">Kembali ke Login</a>
            </div>
        </div>
    </div>

    <!-- ========== MARKETPLACE PAGE ========== -->
    <div id="marketplacePage" class="marketplace-container">
        <!-- Header -->
        <div class="marketplace-header">
            <div class="header-top">
                <div class="logo">XREZZKY STORE</div>
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="Cari produk...">
                    <button onclick="searchProducts()">Cari</button>
                </div>
                <div>
                    <button class="nav-tab" onclick="showAccount()">üë§ Akun</button>
                    <button class="nav-tab" onclick="showCart()">üõí Keranjang</button>
                </div>
            </div>
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="filterProducts('all')">Semua</button>
                <button class="nav-tab" onclick="filterProducts('electronics')">Elektronik</button>
                <button class="nav-tab" onclick="filterProducts('fashion')">Fashion</button>
                <button class="nav-tab" onclick="filterProducts('food')">Makanan</button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="marketplace-content">
            <!-- Sidebar (Account) -->
            <div class="sidebar" id="sidebarAccount" style="display: none;">
                <h3>üìã Data Akun</h3>
                <div id="accountSummary"></div>
                <hr style="margin: 15px 0;">
                <button class="sidebar-item" onclick="showAccount()" style="width: 100%;">Kelola Akun</button>
                <button class="sidebar-item" onclick="showTransactionHistory()" style="width: 100%;">Riwayat Transaksi</button>
                <button class="sidebar-item" onclick="handleLogout()" style="width: 100%;">Log Out</button>
            </div>

            <!-- Main Products -->
            <div class="main-content">
                <div id="productsContainer" class="products-grid"></div>
            </div>
        </div>
    </div>

    <!-- ========== ACCOUNT PAGE ========== -->
    <div id="accountPage" class="account-container">
        <div class="account-card">
            <h2>üë§ Profil Saya</h2>
            <div id="profileInfo"></div>
            <hr style="margin: 20px 0;">
            <div class="form-group">
                <label>Username Baru</label>
                <input type="text" id="newUsername" placeholder="Masukkan username baru">
            </div>
            <div class="form-group">
                <label>Password Baru</label>
                <input type="password" id="newPassword" placeholder="Masukkan password baru">
            </div>
            <button class="btn-primary" onclick="updateProfile()">Update Profil</button>
        </div>

        <div class="account-card">
            <h2>üîê Keamanan</h2>
            <div class="form-group">
                <label>Email Saat Ini</label>
                <input type="email" id="currentEmail" readonly>
            </div>
            <button class="btn-primary" onclick="requestPasswordReset()">Reset Password via Email</button>
        </div>

        <div class="account-card">
            <h2>‚ö†Ô∏è Zona Berbahaya</h2>
            <p style="color: #666; margin-bottom: 20px;">Menghapus akun akan menghapus semua data Anda secara permanen.</p>
            <button class="btn-danger" onclick="deleteAccount()">Hapus Akun</button>
            <button class="btn-logout" onclick="showMarketplace()">Kembali</button>
        </div>
    </div>

    <!-- ========== CART PAGE ========== -->
    <div id="cartPage" class="account-container">
        <div class="account-card">
            <h2>üõí Keranjang Belanja</h2>
            <div id="cartItems"></div>
            <hr style="margin: 20px 0;">
            <div style="text-align: right; font-size: 18px; font-weight: bold; margin-bottom: 20px;">
                Total: Rp <span id="cartTotal">0</span>
            </div>
            <button class="btn-primary" onclick="checkoutCart()">Checkout</button>
            <button class="btn-logout" onclick="showMarketplace()">Kembali</button>
        </div>
    </div>

    <!-- ========== TRANSACTION HISTORY ========== -->
    <div id="transactionPage" class="account-container">
        <div class="account-card">
            <h2>üìú Riwayat Transaksi</h2>
            <div id="transactionList"></div>
            <button class="btn-logout" onclick="showMarketplace()">Kembali</button>
        </div>
    </div>

    <!-- ========== ADMIN PANEL ========== -->
    <div id="adminPanel" class="admin-container">
        <h1>üîß Admin Panel</h1>
        
        <div class="admin-nav">
            <button onclick="showAdminSection('dashboard')" class="active">Dashboard</button>
            <button onclick="showAdminSection('products')">Kelola Produk</button>
            <button onclick="showAdminSection('users')">Kelola User</button>
            <button onclick="showAdminSection('transactions')">Transaksi</button>
            <button onclick="showAdminSection('reports')">Laporan</button>
            <button onclick="handleLogout()">Logout</button>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboardSection" class="admin-section active">
            <h2>Dashboard</h2>
            <p>Selamat datang di Admin Panel Xrezzky Store</p>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                <div style="background: #f0f0f0; padding: 20px; border-radius: 8px;">
                    <h3>üìä Total Penjualan</h3>
                    <p id="totalSales" style="font-size: 24px; font-weight: bold; color: #00bcd4;">0</p>
                </div>
                <div style="background: #f0f0f0; padding: 20px; border-radius: 8px;">
                    <h3>üë• Total User</h3>
                    <p id="totalUsers" style="font-size: 24px; font-weight: bold; color: #00bcd4;">0</p>
                </div>
                <div style="background: #f0f0f0; padding: 20px; border-radius: 8px;">
                    <h3>üì¶ Total Produk</h3>
                    <p id="totalProducts" style="font-size: 24px; font-weight: bold; color: #00bcd4;">0</p>
                </div>
            </div>
        </div>

        <!-- Products Management Section -->
        <div id="productsSection" class="admin-section">
            <h2>Kelola Produk</h2>
            
            <h3 style="margin-top: 30px; margin-bottom: 20px;">Tambah Produk Baru</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 30px;">
                <div class="form-group">
                    <label>Nama Produk</label>
                    <input type="text" id="adminProductName" placeholder="Nama produk">
                </div>
                <div class="form-group">
                    <label>Harga</label>
                    <input type="number" id="adminProductPrice" placeholder="Harga">
                </div>
                <div class="form-group">
                    <label>Stok</label>
                    <input type="number" id="adminProductStock" placeholder="Jumlah stok">
                </div>
                <div class="form-group">
                    <label>Kategori</label>
                    <select id="adminProductCategory" style="padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-family: inherit;">
                        <option value="all">Semua</option>
                        <option value="electronics">Elektronik</option>
                        <option value="fashion">Fashion</option>
                        <option value="food">Makanan</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Detail Produk</label>
                <textarea id="adminProductDetail" placeholder="Jelaskan detail produk..."></textarea>
            </div>
            <button class="btn-primary" onclick="addProduct()">Tambah Produk</button>

            <h3 style="margin-top: 30px; margin-bottom: 20px;">Daftar Produk</h3>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nama</th>
                            <th>Harga</th>
                            <th>Stok</th>
                            <th>Kategori</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="productsTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Users Management Section -->
        <div id="usersSection" class="admin-section">
            <h2>Kelola User</h2>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Tanggal Daftar</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Transactions Section -->
        <div id="transactionsSection" class="admin-section">
            <h2>Manajemen Transaksi</h2>
            
            <h3 style="margin-bottom: 20px;">Konfirmasi Pembelian</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 30px;">
                <div class="form-group">
                    <label>Email Pembeli</label>
                    <input type="email" id="buyerEmail" placeholder="Email pembeli">
                </div>
                <div class="form-group">
                    <label>Username Pembeli</label>
                    <input type="text" id="buyerUsername" placeholder="Username pembeli">
                </div>
                <div class="form-group">
                    <label>Nama Produk</label>
                    <input type="text" id="productName" placeholder="Nama produk">
                </div>
            </div>
            <button class="btn-primary" onclick="confirmPurchase()">Konfirmasi Pembelian</button>

            <h3 style="margin-top: 30px; margin-bottom: 20px;">Riwayat Transaksi</h3>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Pembeli</th>
                            <th>Produk</th>
                            <th>Harga</th>
                            <th>Status</th>
                            <th>Tanggal</th>
                        </tr>
                    </thead>
                    <tbody id="transactionsTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reportsSection" class="admin-section">
            <h2>Laporan Penjualan</h2>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button class="btn-primary" onclick="generateReport('daily')">Laporan Harian</button>
                <button class="btn-primary" onclick="generateReport('weekly')">Laporan Mingguan</button>
                <button class="btn-primary" onclick="generateReport('monthly')">Laporan Bulanan</button>
            </div>

            <h3 style="margin-bottom: 20px;">Produk Terlaris</h3>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Nama Produk</th>
                            <th>Terjual</th>
                            <th>Total Pendapatan</th>
                        </tr>
                    </thead>
                    <tbody id="topProductsTableBody">
                    </tbody>
                </table>
            </div>

            <h3 style="margin-top: 30px; margin-bottom: 20px;">User Paling Aktif</h3>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Total Pembelian</th>
                            <th>Total Belanja</th>
                        </tr>
                    </thead>
                    <tbody id="topUsersTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ========== PRODUCT DETAIL MODAL ========== -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalProductName"></h2>
                <button class="close-btn" onclick="closeProductModal()">&times;</button>
            </div>
            <div class="product-detail-image" id="modalProductImage"></div>
            <div class="product-detail-info">
                <h3 id="modalProductPrice"></h3>
                <p><strong>Stok: </strong><span id="modalProductStock"></span></p>
                <p><strong>Detail:</strong></p>
                <p id="modalProductDetail"></p>
                <div class="rating-stars" id="modalProductRating"></div>
                <button class="btn-primary" onclick="buyProductFromModal()" style="margin-right: 10px;">BELI</button>
                <button class="btn-primary" onclick="addToCartFromModal()" style="margin-right: 10px; background: #ffeb3b; color: black;">KERANJANG</button>
                <button class="btn-primary" onclick="askQuestion()" style="background: #999;">TANYA</button>
                <div class="testimonials" id="modalTestimonials"></div>
            </div>
        </div>
    </div>

    <!-- ========== BOTTOM NAVIGATION ========== -->
    <div class="bottom-nav">
        <div>
            <button class="home-btn" onclick="goToHome()">üè† HOME</button>
            <div class="home-text">XREZZKY STORE</div>
        </div>
    </div>

    <!-- ========== FIREBASE SCRIPT ========== -->
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA75bdcfawOi957by8y_4-l4sJCCo6pF88",
            authDomain: "xrezzkystore-marketplace-83bc0.firebaseapp.com",
            databaseURL: "https://xrezzkystore-marketplace-83bc0-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "xrezzkystore-marketplace-83bc0",
            storageBucket: "xrezzkystore-marketplace-83bc0.firebasestorage.app",
            messagingSenderId: "604900856944",
            appId: "1:604900856944:web:c48c973da45214c68a10b5",
            measurementId: "G-7XG9V48HW0"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        // Global Variables
        let currentUser = null;
        let currentAdminEmail = null;
        let allProducts = [];
        let cart = [];
        let selectedProduct = null;
        const ADMIN_EMAIL = "xrezzkystore.id@gmail.com";
        const ADMIN_PASSWORD = "XREZZKY0930";

        // ========== PAGE NAVIGATION ==========
        function showLogin() {
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('registerPage').style.display = 'none';
            document.getElementById('marketplacePage').style.display = 'none';
            document.getElementById('accountPage').style.display = 'none';
            document.getElementById('cartPage').style.display = 'none';
            document.getElementById('transactionPage').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'none';
        }

        function showRegister() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('registerPage').style.display = 'flex';
        }

        function showForgotPassword() {
            const email = prompt('Masukkan email Anda untuk reset password:');
            if (email) {
                alert('Link reset password telah dikirim ke ' + email + ' melalui Firebase');
            }
        }

        function showMarketplace() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('registerPage').style.display = 'none';
            document.getElementById('marketplacePage').style.display = 'block';
            document.getElementById('accountPage').style.display = 'none';
            document.getElementById('cartPage').style.display = 'none';
            document.getElementById('transactionPage').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('sidebarAccount').style.display = 'none';
            loadProducts();
            loadCart();
        }

        function showAccount() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('registerPage').style.display = 'none';
            document.getElementById('marketplacePage').style.display = 'none';
            document.getElementById('accountPage').style.display = 'block';
            document.getElementById('cartPage').style.display = 'none';
            document.getElementById('transactionPage').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'none';
            loadUserProfile();
        }

        function showCart() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('registerPage').style.display = 'none';
            document.getElementById('marketplacePage').style.display = 'none';
            document.getElementById('accountPage').style.display = 'none';
            document.getElementById('cartPage').style.display = 'block';
            document.getElementById('transactionPage').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'none';
            displayCart();
        }

        function showTransactionHistory() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('registerPage').style.display = 'none';
            document.getElementById('marketplacePage').style.display = 'none';
            document.getElementById('accountPage').style.display = 'none';
            document.getElementById('cartPage').style.display = 'none';
            document.getElementById('transactionPage').style.display = 'block';
            document.getElementById('adminPanel').style.display = 'none';
            loadTransactionHistory();
        }

        function showAdminPanel() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('registerPage').style.display = 'none';
            document.getElementById('marketplacePage').style.display = 'none';
            document.getElementById('accountPage').style.display = 'none';
            document.getElementById('cartPage').style.display = 'none';
            document.getElementById('transactionPage').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
            loadAdminDashboard();
            loadProductsTable();
            loadUsersTable();
            loadTransactionsTable();
        }

        function goToHome() {
            window.location.href = 'https://xrezzky-web.github.io/xrezzkystore/';
        }

        // ========== LOGIN & REGISTER ==========
        function handleLogin() {
            const username = document.getElementById('loginUsername').value;
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            // Check if admin login
            if (email === ADMIN_EMAIL && password === ADMIN_PASSWORD) {
                currentAdminEmail = email;
                showAdminPanel();
                return;
            }

            // Regular user login
            db.ref('users').orderByChild('email').equalTo(email).once('value', snapshot => {
                if (snapshot.exists()) {
                    const users = snapshot.val();
                    const user = Object.values(users)[0];
                    
                    if (user.password === password) {
                        currentUser = {
                            id: Object.keys(users)[0],
                            ...user
                        };
                        showMarketplace();
                        alert('Login berhasil!');
                    } else {
                        alert('Password salah!');
                    }
                } else {
                    alert('Email tidak ditemukan!');
                }
            });
        }

        function handleRegister() {
            const username = document.getElementById('regUsername').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;

            if (!username || !email || !password || !confirmPassword) {
                alert('Semua field harus diisi!');
                return;
            }

            if (password !== confirmPassword) {
                alert('Password tidak cocok!');
                return;
            }

            // Check if email already exists
            db.ref('users').orderByChild('email').equalTo(email).once('value', snapshot => {
                if (snapshot.exists()) {
                    alert('Email sudah terdaftar!');
                } else {
                    const newUser = {
                        username: username,
                        email: email,
                        password: password,
                        createdAt: new Date().toISOString()
                    };

                    db.ref('users').push(newUser).then(() => {
                        alert('Akun berhasil dibuat! Silakan login.');
                        showLogin();
                    }).catch(error => {
                        alert('Error: ' + error.message);
                    });
                }
            });
        }

        function handleLogout() {
            currentUser = null;
            currentAdminEmail = null;
            showLogin();
            alert('Logout berhasil!');
        }

        // ========== PRODUCTS ==========
        function loadProducts() {
            db.ref('products').on('value', snapshot => {
                allProducts = [];
                snapshot.forEach(childSnapshot => {
                    allProducts.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                displayProducts(allProducts);
            });
        }

        function displayProducts(products) {
            const container = document.getElementById('productsContainer');
            container.innerHTML = '';

            if (products.length === 0) {
                container.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #999;">Tidak ada produk</p>';
                return;
            }

            products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <div class="product-image" onclick="openProductModal('${product.id}')">${product.name}</div>
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="product-price">Rp ${Number(product.price).toLocaleString('id-ID')}</div>
                        <div class="product-stock">Stok: ${product.stock}</div>
                        <div class="product-buttons">
                            <button class="btn-small btn-buy" onclick="buyProduct('${product.id}')">BELI</button>
                            <button class="btn-small btn-cart" onclick="addToCart('${product.id}')">KERANJANG</button>
                            <button class="btn-small btn-question" onclick="askQuestion('${product.id}')">TANYA</button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function filterProducts(category) {
            const buttons = document.querySelectorAll('.nav-tab');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (category === 'all') {
                displayProducts(allProducts);
            } else {
                const filtered = allProducts.filter(p => p.category === category);
                displayProducts(filtered);
            }
        }

        function searchProducts() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allProducts.filter(p => 
                p.name.toLowerCase().includes(search) || 
                p.city?.toLowerCase().includes(search)
            );
            displayProducts(filtered);
        }

        // ========== PRODUCT MODAL ==========
        function openProductModal(productId) {
            const product = allProducts.find(p => p.id === productId);
            if (!product) return;

            selectedProduct = product;
            document.getElementById('modalProductName').textContent = product.name;
            document.getElementById('modalProductImage').textContent = product.name;
            document.getElementById('modalProductPrice').textContent = 'Rp ' + Number(product.price).toLocaleString('id-ID');
            document.getElementById('modalProductStock').textContent = product.stock;
            document.getElementById('modalProductDetail').textContent = product.detail || 'Tidak ada detail produk';

            // Load testimonials
            loadTestimonials(productId);

            document.getElementById('productModal').style.display = 'block';
        }

        function closeProductModal() {
            document.getElementById('productModal').style.display = 'none';
        }

        function loadTestimonials(productId) {
            db.ref('testimonials').orderByChild('productId').equalTo(productId).once('value', snapshot => {
                const container = document.getElementById('modalTestimonials');
                container.innerHTML = '<h4>Testimoni Pembeli</h4>';

                if (!snapshot.exists()) {
                    container.innerHTML += '<p style="color: #999;">Belum ada testimoni</p>';
                    return;
                }

                snapshot.forEach(childSnapshot => {
                    const testimonial = childSnapshot.val();
                    container.innerHTML += `
                        <div class="testimonial-item">
                            <div class="testimonial-name">${testimonial.username}</div>
                            <div class="testimonial-date">${new Date(testimonial.date).toLocaleString('id-ID')}</div>
                            <div class="testimonial-text">${testimonial.review}</div>
                        </div>
                    `;
                });
            });
        }

        // ========== CART ==========
        function addToCart(productId) {
            const product = allProducts.find(p => p.id === productId);
            if (!product) return;

            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: productId,
                    name: product.name,
                    price: product.price,
                    quantity: 1
                });
            }

            saveCart();
            alert(product.name + ' ditambahkan ke keranjang!');
        }

        function addToCartFromModal() {
            if (selectedProduct) {
                addToCart(selectedProduct.id);
            }
        }

        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(cart));
        }

        function loadCart() {
            const saved = localStorage.getItem('cart');
            cart = saved ? JSON.parse(saved) : [];
        }

        function displayCart() {
            const container = document.getElementById('cartItems');
            const totalElement = document.getElementById('cartTotal');
            container.innerHTML = '';

            if (cart.length === 0) {
                container.innerHTML = '<p style="color: #999;">Keranjang kosong</p>';
                totalElement.textContent = '0';
                return;
            }

            let total = 0;
            cart.forEach((item, index) => {
                const subtotal = item.price * item.quantity;
                total += subtotal;

                container.innerHTML += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #f9f9f9; margin-bottom: 10px; border-radius: 8px;">
                        <div>
                            <div style="font-weight: bold;">${item.name}</div>
                            <div style="color: #666; font-size: 14px;">Rp ${Number(item.price).toLocaleString('id-ID')} √ó ${item.quantity}</div>
                        </div>
                        <div>
                            <div style="text-align: right; font-weight: bold; margin-bottom: 10px;">Rp ${Number(subtotal).toLocaleString('id-ID')}</div>
                            <button class="btn-delete" onclick="removeFromCart(${index})">Hapus</button>
                        </div>
                    </div>
                `;
            });

            totalElement.textContent = Number(total).toLocaleString('id-ID');
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            saveCart();
            displayCart();
        }

        function checkoutCart() {
            if (cart.length === 0) {
                alert('Keranjang kosong!');
                return;
            }

            if (!currentUser) {
                alert('Silakan login terlebih dahulu!');
                return;
            }

            const transaction = {
                userId: currentUser.id,
                username: currentUser.username,
                email: currentUser.email,
                items: cart,
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                status: 'pending',
                createdAt: new Date().toISOString()
            };

            db.ref('transactions').push(transaction).then(() => {
                // Reduce stock
                cart.forEach(item => {
                    const product = allProducts.find(p => p.id === item.id);
                    if (product) {
                        db.ref('products/' + item.id + '/stock').set(product.stock - item.quantity);
                    }
                });

                cart = [];
                saveCart();
                alert('Checkout berhasil! Silakan hubungi admin untuk konfirmasi pembayaran.\nWhatsApp: https://wa.me/6288293064112');
                showMarketplace();
            }).catch(error => {
                alert('Error: ' + error.message);
            });
        }

        // ========== TRANSACTIONS ==========
        function loadTransactionHistory() {
            db.ref('transactions').orderByChild('userId').equalTo(currentUser.id).once('value', snapshot => {
                const container = document.getElementById('transactionList');
                container.innerHTML = '';

                if (!snapshot.exists()) {
                    container.innerHTML = '<p style="color: #999;">Belum ada riwayat transaksi</p>';
                    return;
                }

                snapshot.forEach(childSnapshot => {
                    const transaction = childSnapshot.val();
                    const items = transaction.items.map(item => item.name).join(', ');
                    
                    container.innerHTML += `
                        <div style="padding: 15px; background: #f9f9f9; margin-bottom: 15px; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <div>
                                    <div style="font-weight: bold;">${items}</div>
                                    <div style="color: #666; font-size: 12px;">${new Date(transaction.createdAt).toLocaleString('id-ID')}</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-weight: bold;">Rp ${Number(transaction.total).toLocaleString('id-ID')}</div>
                                    <div style="font-size: 12px; color: ${transaction.status === 'completed' ? '#4CAF50' : '#ff9800'};">${transaction.status}</div>
                                </div>
                            </div>
                        </div>
                    `;
                });
            });
        }

        // ========== USER PROFILE ==========
        function loadUserProfile() {
            const container = document.getElementById('profileInfo');
            container.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <p><strong>Username:</strong> ${currentUser.username}</p>
                    <p><strong>Email:</strong> ${currentUser.email}</p>
                    <p><strong>Terdaftar:</strong> ${new Date(currentUser.createdAt).toLocaleDateString('id-ID')}</p>
                </div>
            `;

            document.getElementById('currentEmail').value = currentUser.email;
        }

        function updateProfile() {
            const newUsername = document.getElementById('newUsername').value;
            const newPassword = document.getElementById('newPassword').value;

            if (!newUsername && !newPassword) {
                alert('Masukkan username atau password baru!');
                return;
            }

            const updates = {};
            if (newUsername) updates.username = newUsername;
            if (newPassword) updates.password = newPassword;

            db.ref('users/' + currentUser.id).update(updates).then(() => {
                currentUser = { ...currentUser, ...updates };
                alert('Profil berhasil diupdate!');
                loadUserProfile();
            }).catch(error => {
                alert('Error: ' + error.message);
            });
        }

        function requestPasswordReset() {
            alert('Link reset password telah dikirim ke ' + currentUser.email + ' melalui Firebase');
        }

        function deleteAccount() {
            if (confirm('Yakin ingin menghapus akun? Semua data akan hilang!')) {
                db.ref('users/' + currentUser.id).remove().then(() => {
                    alert('Akun berhasil dihapus!');
                    handleLogout();
                }).catch(error => {
                    alert('Error: ' + error.message);
                });
            }
        }

        // ========== BUY PRODUCT ==========
        function buyProduct(productId) {
            const product = allProducts.find(p => p.id === productId);
            if (!product || product.stock === 0) {
                alert('Produk tidak tersedia!');
                return;
            }

            if (!currentUser) {
                alert('Silakan login terlebih dahulu!');
                showLogin();
                return;
            }

            const wa_link = 'https://wa.me/6288293064112?text=Saya%20ingin%20membeli%20' + encodeURIComponent(product.name);
            window.open(wa_link, '_blank');
        }

        function buyProductFromModal() {
            if (selectedProduct) {
                buyProduct(selectedProduct.id);
            }
        }

        function askQuestion(productId) {
            if (!currentUser) {
                alert('Silakan login terlebih dahulu!');
                showLogin();
                return;
            }

            const product = allProducts.find(p => p.id === productId);
            if (!product) return;

            const question = prompt('Tanyakan tentang ' + product.name + ':');
            if (question) {
                const inquiry = {
                    productId: productId,
                    userId: currentUser.id,
                    username: currentUser.username,
                    email: currentUser.email,
                    question: question,
                    createdAt: new Date().toISOString()
                };

                db.ref('inquiries').push(inquiry).then(() => {
                    alert('Pertanyaan berhasil dikirim!');
                }).catch(error => {
                    alert('Error: ' + error.message);
                });
            }
        }

        // ========== ADMIN FUNCTIONS ==========
        function loadAdminDashboard() {
            db.ref('transactions').once('value', snapshot => {
                let totalSales = 0;
                if (snapshot.exists()) {
                    snapshot.forEach(child => {
                        totalSales += child.val().total || 0;
                    });
                }
                document.getElementById('totalSales').textContent = 'Rp ' + Number(totalSales).toLocaleString('id-ID');
            });

            db.ref('users').once('value', snapshot => {
                document.getElementById('totalUsers').textContent = snapshot.size;
            });

            db.ref('products').once('value', snapshot => {
                document.getElementById('totalProducts').textContent = snapshot.size;
            });
        }

        function showAdminSection(section) {
            document.querySelectorAll('.admin-section').forEach(el => el.classList.remove('active'));
            document.getElementById(section + 'Section').classList.add('active');

            document.querySelectorAll('.admin-nav button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function addProduct() {
            const name = document.getElementById('adminProductName').value;
            const price = document.getElementById('adminProductPrice').value;
            const stock = document.getElementById('adminProductStock').value;
            const category = document.getElementById('adminProductCategory').value;
            const detail = document.getElementById('adminProductDetail').value;

            if (!name || !price || !stock) {
                alert('Semua field harus diisi!');
                return;
            }

            const product = {
                name: name,
                price: parseInt(price),
                stock: parseInt(stock),
                category: category,
                detail: detail,
                createdAt: new Date().toISOString()
            };

            db.ref('products').push(product).then(() => {
                alert('Produk berhasil ditambahkan!');
                document.getElementById('adminProductName').value = '';
                document.getElementById('adminProductPrice').value = '';
                document.getElementById('adminProductStock').value = '';
                document.getElementById('adminProductDetail').value = '';
                loadProductsTable();
            }).catch(error => {
                alert('Error: ' + error.message);
            });
        }

        function loadProductsTable() {
            db.ref('products').once('value', snapshot => {
                const tbody = document.getElementById('productsTableBody');
                tbody.innerHTML = '';

                snapshot.forEach(childSnapshot => {
                    const product = childSnapshot.val();
                    tbody.innerHTML += `
                        <tr>
                            <td>${childSnapshot.key.substr(0, 8)}</td>
                            <t
